{% extends 'base.html' %}
{% block content %}

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<!-- 
<script> 
    let map

    function initMap(){

        var locations = {{ locations|safe }};
        var firstLocation = locations[0]
        var infoWindow = []

        map = new google.maps.Map(document.getElementById("map"),{
            center: { lat: firstLocation.lat, lng: firstLocation.lng }, 
            zoom: 4,
        }
        );

        locations.forEach(function (location){
            var marker = new google.maps.Marker({
                position: {lat: location.lat, lng: location.lng}, 
                map: map, 
                title: location.name
            });

            var infowindow = new google.maps.InfoWindow({
                content: location.name, 
            });

            infoWindow.push(infowindow)

            marker.addListener('click', function(){
                infoWindow.forEach(function(iw){
                    iw.close();
                });

                infowindow.open(map, marker)
            });
        });
    }

    window.initMap = initMap

</script> -->
<script>
  let map

function initMap(){
    var locations = {{ locations|safe }};
    var firstLocation = locations[0];
    var infoWindow = [];

    map = new google.maps.Map(document.getElementById("map"),{
        center: { lat: firstLocation.lat, lng: firstLocation.lng }, 
        zoom: 4,
    });

    locations.forEach(function (location){
        var marker = new google.maps.Marker({
            position: {lat: location.lat, lng: location.lng}, 
            map: map, 
            title: location.name,
            icon: getPinColor(location.color)  // Use color property for pin color
        });

        var infowindow = new google.maps.InfoWindow({
            content: location.name, 
        });

        infoWindow.push(infowindow);

        marker.addListener('click', function(){
            infoWindow.forEach(function(iw){
                iw.close();
            });

            infowindow.open(map, marker);
        });
    });
}

function getPinColor(color) {
    // Define your pin colors based on the color property
    switch(color) {
        case 'red':
            return 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';
        case 'blue':
            return 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png';
        case 'green':
            return 'http://maps.google.com/mapfiles/ms/icons/green-dot.png';
        // Add more cases for additional colors
        default:
            return 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'; // Default color
    }
}

window.initMap = initMap;
</script>

<div class="pageholder">
    <h2>Welcome, {{ request.session.name }}!</h2>


    <div class="linkholder">
        <div class="mapholder"> 
            <div id="map"> </div>

            <script async
                src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap">
            </script>

        </div>
        
     </div>


  


</div>
<script>
      function updateEditableText(value) {
        // You can add additional logic here if needed

        console.log("Current text: " + {{ locations|safe }});
    }
</script>

{% endblock %}